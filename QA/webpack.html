<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta name="keywords" content="web前端,前端面试题,HTML5,CSS3,CSS,jQuery,JS,JavaScript,前端,vue,博客,技术文章,静水深流,react,18禁"><meta name="author" content="shaolibao"><meta name="google-site-verification" content="018PP6ptGKwOerKbKgiOwbvtEvXE4z1MbWL70S53pUg"><meta name="baidu-site-verification" content="code-zwVA5PHMGk"><meta name="360-site-verification" content="1e93b200c2a643d4d9569c2315bd46a2"><meta name="sogou_site_verification" content="riHbZyBSqZ"><meta name="msvalidate.01" content="18F16D4763157255069DFE0F9ADEF271"><link rel="shortcut icon" href="/link.jpg" type="image/jpg"><link rel="manifest" href="/manifest.webmanifest"><meta name="theme-color" content="#1e90ff"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="apple-touch-icon" href="/link.jpg"><link rel="mask-icon" href="/link.jpg" color="#1e90ff"><meta name="msapplication-TileImage" content="/link.jpg"><meta name="msapplication-TileColor" content="#000000"><link rel="stylesheet" href="https://slbblog.oss-cn-beijing.aliyuncs.com/s3Layer.css"><script src="https://hm.baidu.com/hm.js?5ebfc1c23339503a9d4d7fae0f2b1f17" defer="true"></script><script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5929253442306992" crossorigin="anonymous" async></script><title>webpack开发、使用及优化总结 | 静水深流</title><meta name="description" content="本文总结webpack的一些使用，原理及优化；webpack已成为前端打包的主流工具，它的作用是对项目中的静态资源进行统一管理，为项目的发布提供最优的打包和部署方案，可以把应用中的js、css、图片等资源集中打成一个或多个包文件。">
    <link rel="modulepreload" href="/assets/app.fded88d1.js"><link rel="modulepreload" href="/assets/webpack.html.a609a935.js"><link rel="modulepreload" href="/assets/webpack.html.81589ebc.js"><link rel="prefetch" href="/assets/index.html.ff05003d.js"><link rel="prefetch" href="/assets/link.html.507bf71d.js"><link rel="prefetch" href="/assets/list.html.ff505004.js"><link rel="prefetch" href="/assets/css.html.7f733be1.js"><link rel="prefetch" href="/assets/free.html.0feb0fcf.js"><link rel="prefetch" href="/assets/http.html.435b0012.js"><link rel="prefetch" href="/assets/js-theory.html.4ebdf728.js"><link rel="prefetch" href="/assets/virtaul.html.91460542.js"><link rel="prefetch" href="/assets/vue.html.36a4848b.js"><link rel="prefetch" href="/assets/cache.html.0cbdab91.js"><link rel="prefetch" href="/assets/diff.html.57dd80cf.js"><link rel="prefetch" href="/assets/easy.html.233613c9.js"><link rel="prefetch" href="/assets/hard.html.9c4848c0.js"><link rel="prefetch" href="/assets/medium.html.3aee136b.js"><link rel="prefetch" href="/assets/sort.html.6f1a08a5.js"><link rel="prefetch" href="/assets/study.html.482502b1.js"><link rel="prefetch" href="/assets/shape.html.2d3e013d.js"><link rel="prefetch" href="/assets/safe.html.d33be7f7.js"><link rel="prefetch" href="/assets/sse.html.154efe35.js"><link rel="prefetch" href="/assets/axios.html.6903b3c6.js"><link rel="prefetch" href="/assets/bit.html.66197f95.js"><link rel="prefetch" href="/assets/clone.html.d5486022.js"><link rel="prefetch" href="/assets/copy.html.55febbab.js"><link rel="prefetch" href="/assets/diff.html.2f433539.js"><link rel="prefetch" href="/assets/domCode.html.17db01a3.js"><link rel="prefetch" href="/assets/extend.html.24791588.js"><link rel="prefetch" href="/assets/flatten.html.02862112.js"><link rel="prefetch" href="/assets/genre.html.13d56231.js"><link rel="prefetch" href="/assets/js.html.3fde62f5.js"><link rel="prefetch" href="/assets/type.html.0c84c9b2.js"><link rel="prefetch" href="/assets/blog.html.127ad1f4.js"><link rel="prefetch" href="/assets/blog_old.html.1c40ee5d.js"><link rel="prefetch" href="/assets/oauth.html.46e5d03a.js"><link rel="prefetch" href="/assets/zoom.html.17d16f08.js"><link rel="prefetch" href="/assets/404.html.50edea1e.js"><link rel="prefetch" href="/assets/index.html.8d91edcc.js"><link rel="prefetch" href="/assets/link.html.3f0e9706.js"><link rel="prefetch" href="/assets/list.html.d90ec71c.js"><link rel="prefetch" href="/assets/css.html.71c1ac2d.js"><link rel="prefetch" href="/assets/free.html.b3bde6ce.js"><link rel="prefetch" href="/assets/http.html.23976a1a.js"><link rel="prefetch" href="/assets/js-theory.html.40bc387a.js"><link rel="prefetch" href="/assets/virtaul.html.09b3b2e4.js"><link rel="prefetch" href="/assets/vue.html.0e605c45.js"><link rel="prefetch" href="/assets/cache.html.e4f1c686.js"><link rel="prefetch" href="/assets/diff.html.d37ccae3.js"><link rel="prefetch" href="/assets/easy.html.f81ed90e.js"><link rel="prefetch" href="/assets/hard.html.a13d0829.js"><link rel="prefetch" href="/assets/medium.html.8c2f1876.js"><link rel="prefetch" href="/assets/sort.html.7976d748.js"><link rel="prefetch" href="/assets/study.html.519196f5.js"><link rel="prefetch" href="/assets/shape.html.b86a87a0.js"><link rel="prefetch" href="/assets/safe.html.6f870daf.js"><link rel="prefetch" href="/assets/sse.html.0ded2924.js"><link rel="prefetch" href="/assets/axios.html.3521c585.js"><link rel="prefetch" href="/assets/bit.html.7e38910d.js"><link rel="prefetch" href="/assets/clone.html.a3f4f8c8.js"><link rel="prefetch" href="/assets/copy.html.81e8940a.js"><link rel="prefetch" href="/assets/diff.html.8f3d4f3a.js"><link rel="prefetch" href="/assets/domCode.html.5af9dbb4.js"><link rel="prefetch" href="/assets/extend.html.08b6491f.js"><link rel="prefetch" href="/assets/flatten.html.2dcb730c.js"><link rel="prefetch" href="/assets/genre.html.c2f4dbdd.js"><link rel="prefetch" href="/assets/js.html.6f50e308.js"><link rel="prefetch" href="/assets/type.html.95a7c0e6.js"><link rel="prefetch" href="/assets/blog.html.6f407294.js"><link rel="prefetch" href="/assets/blog_old.html.970a710d.js"><link rel="prefetch" href="/assets/oauth.html.21dac46c.js"><link rel="prefetch" href="/assets/zoom.html.3a97e1d1.js"><link rel="prefetch" href="/assets/404.html.22449b3e.js"><link rel="prefetch" href="/assets/index.6fc1ed56.js"><link rel="prefetch" href="/assets/giscus.9d85e3c1.js"><link rel="prefetch" href="/assets/s3Layer.umd.min.9cf41daf.js">
    <link rel="stylesheet" href="/assets/style.815e0284.css">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!----><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">静水深流</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/list.html" class="" aria-label="文章"><!--[--><!--]--> 文章 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://slbyml.github.io/jsLibrary/" rel="noopener noreferrer" target="_blank" aria-label="demo"><!--[--><!--]--> demo <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/slbyml" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/list.html" class="" aria-label="文章"><!--[--><!--]--> 文章 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://slbyml.github.io/jsLibrary/" rel="noopener noreferrer" target="_blank" aria-label="demo"><!--[--><!--]--> demo <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/slbyml" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">webpack开发、使用及优化总结 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/QA/webpack.html#构建流程" class="router-link-active router-link-exact-active sidebar-item" aria-label="构建流程"><!--[--><!--]--> 构建流程 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/QA/webpack.html#hash-chunkhash-contenthash的区别" class="router-link-active router-link-exact-active sidebar-item" aria-label="Hash&amp;ChunkHash&amp;ContentHash的区别"><!--[--><!--]--> Hash&amp;ChunkHash&amp;ContentHash的区别 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/QA/webpack.html#webpack是解决什么问题而生的" class="router-link-active router-link-exact-active sidebar-item" aria-label="webpack是解决什么问题而生的?"><!--[--><!--]--> webpack是解决什么问题而生的? <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/QA/webpack.html#tree-shaking使用" class="router-link-active router-link-exact-active sidebar-item" aria-label="tree-shaking使用"><!--[--><!--]--> tree-shaking使用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/QA/webpack.html#如何打包-到浏览器如何解包" class="router-link-active router-link-exact-active sidebar-item" aria-label="如何打包，到浏览器如何解包"><!--[--><!--]--> 如何打包，到浏览器如何解包 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/QA/webpack.html#利用webpack如何优化前端性能" class="router-link-active router-link-exact-active sidebar-item" aria-label="利用webpack如何优化前端性能?"><!--[--><!--]--> 利用webpack如何优化前端性能? <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/QA/webpack.html#webpack的plugins的实现原理" class="router-link-active router-link-exact-active sidebar-item" aria-label="webpack的plugins的实现原理"><!--[--><!--]--> webpack的plugins的实现原理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/QA/webpack.html#webpack的loaders的实现原理" class="router-link-active router-link-exact-active sidebar-item" aria-label="webpack的loaders的实现原理"><!--[--><!--]--> webpack的loaders的实现原理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/QA/webpack.html#code-split-介绍" class="router-link-active router-link-exact-active sidebar-item" aria-label="code split 介绍"><!--[--><!--]--> code split 介绍 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/QA/webpack.html#webpack优化" class="router-link-active router-link-exact-active sidebar-item" aria-label="webpack优化"><!--[--><!--]--> webpack优化 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/QA/webpack.html#webpack-热更新原理" class="router-link-active router-link-exact-active sidebar-item" aria-label="webpack 热更新原理"><!--[--><!--]--> webpack 热更新原理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/QA/webpack.html#webpack环境变量" class="router-link-active router-link-exact-active sidebar-item" aria-label="webpack环境变量"><!--[--><!--]--> webpack环境变量 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/QA/webpack.html#gulp和webpack的区别" class="router-link-active router-link-exact-active sidebar-item" aria-label="gulp和webpack的区别"><!--[--><!--]--> gulp和webpack的区别 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="webpack开发、使用及优化总结" tabindex="-1"><a class="header-anchor" href="#webpack开发、使用及优化总结" aria-hidden="true">#</a> webpack开发、使用及优化总结</h1><p><a href="https://zhuanlan.zhihu.com/p/44438844" target="_blank" rel="noopener noreferrer">参考<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="构建流程" tabindex="-1"><a class="header-anchor" href="#构建流程" aria-hidden="true">#</a> 构建流程</h2><ul><li><code>初始化参数</code>：从配置文件和 Shell 语句中读取与合并参数，得出最终的参数；</li><li><code>开始编译</code>：用上一步得到的参数初始化 Compiler 对象，加载所有配置的插件和生命周期，执行对象的 run 方法开始执行编译；</li><li><code>确定入口</code>：根据配置中的 entry 找出所有的入口文件</li><li><code>编译模块</code>：从入口文件出发，调用所有配置的 Loader 对模块进行翻译(转化为AST树进行处理)，再找出该模块依赖的模块，再递归本步骤直到所有入口依赖的文件都经过了本步骤的处理；</li><li><code>完成模块编译</code>：在经过第4步使用 Loader 翻译完所有模块后，得到了每个模块被翻译后的最终内容以及它们之间的依赖关系；</li><li><code>输出资源</code>：根据入口和模块之间的依赖关系，组装成一个个包含多个模块的 Chunk，再把每个 Chunk 转换成一个单独的文件加入到输出列表，这步是可以修改输出内容的最后机会；</li><li><code>输出完成</code>：在确定好输出内容后，根据配置确定输出的路径和文件名，把文件内容写入到文件系统。</li></ul><h2 id="hash-chunkhash-contenthash的区别" tabindex="-1"><a class="header-anchor" href="#hash-chunkhash-contenthash的区别" aria-hidden="true">#</a> Hash&amp;ChunkHash&amp;ContentHash的区别</h2><ul><li><code>hash</code>:根据构建目录生成,只要项目中有文件修改，则整个项目构建出来的hash都会改变</li><li><code>chunkhash</code>:和webpack打包到chunk有关，不同entry会生成不同的ChunkHush。chunk之间互不影响。(一般用来打包公用js)</li><li><code>contenthash</code>:根据文件内容生成hash，只要文件内容不变，生成的ContentHash就不变(一般用来打包css)</li></ul><h2 id="webpack是解决什么问题而生的" tabindex="-1"><a class="header-anchor" href="#webpack是解决什么问题而生的" aria-hidden="true">#</a> webpack是解决什么问题而生的?</h2><p>webpack 为前端的工程化开发提供了一套相对容易和完整的解决方案</p><h2 id="tree-shaking使用" tabindex="-1"><a class="header-anchor" href="#tree-shaking使用" aria-hidden="true">#</a> tree-shaking使用</h2><ul><li>使用ES6模块</li><li>Babel默认会将任何模块类型都转译成CommonJS类型；所以需要在<code>.babelrc</code>文件中或在<code>webpack.config.js</code>文件中设置<code>modules： false</code></li><li>使用<code>UglifyJsPlugin</code>插件</li></ul><h2 id="如何打包-到浏览器如何解包" tabindex="-1"><a class="header-anchor" href="#如何打包-到浏览器如何解包" aria-hidden="true">#</a> 如何打包，到浏览器如何解包</h2><h2 id="利用webpack如何优化前端性能" tabindex="-1"><a class="header-anchor" href="#利用webpack如何优化前端性能" aria-hidden="true">#</a> 利用webpack如何优化前端性能?</h2><h2 id="webpack的plugins的实现原理" tabindex="-1"><a class="header-anchor" href="#webpack的plugins的实现原理" aria-hidden="true">#</a> webpack的plugins的实现原理</h2><ul><li>Webpack 启动后，在读取配置的过程中会先执行 new myPlugin(options) 初始化一个 myPlugin 获得其实例。</li><li>在初始化 compiler 对象后，再调用 myPlugin.apply(compiler) 给插件实例传入 compiler 对象。</li><li>插件实例在获取到 compiler 对象后，就可以通过 hooks(webpack 把编译过程中触发的各类关键事件封装成事件接口的钩子)监听到 Webpack 发布出来的事件。 并且可以通过 compiler 对象去操作 Webpack。</li></ul><h2 id="webpack的loaders的实现原理" tabindex="-1"><a class="header-anchor" href="#webpack的loaders的实现原理" aria-hidden="true">#</a> webpack的loaders的实现原理</h2><p>每个 Webpack 的 Loader 都需要导出一个函数，这个函数就是我们这个 Loader 对资源的处理过程，它的输入就是加载到的资源文件内容，输出就是我们加工后的结果。我们通过 source 参数接收输入，通过返回值输出</p><h2 id="code-split-介绍" tabindex="-1"><a class="header-anchor" href="#code-split-介绍" aria-hidden="true">#</a> code split 介绍</h2><p>为了减少HTTP请求，通常我们会讲所有代码打包到一个文件中，但是如果文件过大，也会影响页面的加载速度，尤其是会增加白屏时间，所以我们不妨将代码分成一块一块的；并且只在需要的时候去加载它；还可以利用浏览器将这些模块缓存起来；一般情况下分离有两种</p><ul><li>将第三方代码从业务代码中抽离（verdor）</li><li>根据不同入口的业务代码按需加载（利用 import()语法）</li></ul><h2 id="webpack优化" tabindex="-1"><a class="header-anchor" href="#webpack优化" aria-hidden="true">#</a> webpack优化</h2><p>webpack优化的瓶颈主要有两个方面:<code>构建过程耗时</code>、<code>打包的体积太大</code>;</p><blockquote><p>针对构建时间的优化(从依赖分析、依赖编译、处理输出三个方向):</p></blockquote><ul><li>开发环境下启动<code>hard-source-webpack-plugin</code>,通过缓存编译过程优化启动速度</li><li>loader处理结果缓存 <ol><li>babel-loader缓存,通过<code>cacheDirectory</code>开启缓存<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>webpack<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules<span class="token operator">:</span><span class="token punctuation">{</span>
  <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;babel-loader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">babelrc</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token comment">// 将 babel 编译过的模块缓存在 webpack_cache 目录下，下次优先复用</span>
        <span class="token literal-property property">cacheDirectory</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>eslint-loader缓存,通过<code>cache</code>选项指定缓存路径；注：配置更后如果不起作用则需要将<code>cache</code>文件删除<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>webpack<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules<span class="token operator">:</span><span class="token punctuation">{</span>
  <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(js|vue)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token string">&#39;pre&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 启动缓存</span>
        <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">loader</span><span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;eslint-loader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>css/scss缓存通过<code>cache-loader</code>辅助构建结果缓存</li></ol></li><li>缩小编译范围，减少不必要的检索与递归遍历、编译工作 <ol><li>指定模块解析路径，加速模块查找<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>webpack<span class="token punctuation">.</span>resolve<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// 指定以下目录寻找第三方模块，避免webpack往父级目录递归搜索</span>
  <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&#39;node_modules&#39;</span><span class="token punctuation">,</span> 
    path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>projectDir<span class="token punctuation">,</span> <span class="token string">&#39;src&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>projectDir<span class="token punctuation">,</span> <span class="token string">&#39;node_modules&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>忽略未用模块化的库，不去解析它们以提升编译速度<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>webpack<span class="token punctuation">.</span>module<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">noParse</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules\/(jQuery|chart\.js)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>通过<code>alias</code>配置别名， 减小查找过程</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>    webpack<span class="token punctuation">.</span>resolve<span class="token operator">:</span> <span class="token punctuation">{</span> 
      <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">react</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./node_modules/react/dist/react.min.js&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>为loader添加<code>include/exclude</code>缩小babel的编译范围</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>webpack<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&#39;babel-loader&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 将 babel 编译过的模块缓存在 webpack_cache 目录下，下次优先复用</span>
        <span class="token literal-property property">cacheDirectory</span><span class="token operator">:</span> <span class="token string">&#39;./webpack_cache/&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 减少 babel 编译范围，忘记设置会让 webpack 编译慢上好几倍</span>
    <span class="token literal-property property">include</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;src&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>通过<code>uglifyjs-webpack-plugin</code>插件开启多个子线程压缩代码</li><li>通过<code>Happypack</code>开启多线程加速loader对文件的转换速度；使用 HappyPack 也有一些限制，它只兼容部分<a href="https://github.com/amireh/happypack/wiki/Loader-Compatibility-List" target="_blank" rel="noopener noreferrer">主流的 loader<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>；webpack4已经弃用,推荐用<code>thread-loader</code><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;happypack/loader?id=babel&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">include</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;src&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HappyPack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;babel&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">loaders</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&#39;babel-loader&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{</span>  
          <span class="token literal-property property">cacheDirectory</span><span class="token operator">:</span> <span class="token string">&#39;./webpack_cache/&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>使用<code>thread-loader</code>放置在其他 loader 之前;放置在这个 loader 之后的 loader 就会在一个单独的 worker【worker pool】 池里运行;<code>请仅在耗时的 loader 上使用</code>；<a href="https://webpack.docschina.org/loaders/thread-loader/" target="_blank" rel="noopener noreferrer">文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token comment">// 创建一个 js worker 池</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span> 
          <span class="token string">&#39;thread-loader&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;babel-loader&#39;</span>
        <span class="token punctuation">]</span> 
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.s?css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token comment">// 创建一个 css worker 池</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&#39;style-loader&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;thread-loader&#39;</span><span class="token punctuation">,</span>
          <span class="token string">&#39;css-loader&#39;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">&#39;postcss-loader&#39;</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>针对打包体积的优化</p></blockquote><ul><li>用<code>DllPlugin</code>和<code>DllReferencePlugin</code>提前打包公共模块；注：不建议将所有公共模块放在dll中，否则无法用webpack的<code>代码分割</code>和<code>按需加载功能</code></li><li>使用<code>ModuleConcatenationPlugin</code>插件开启<code>scope-hoisting(作用域提升)</code>功能，尽可能的把打包出来的模块合并到一个函数中去（代码需要符合es6的module规范） <blockquote><p>注意： webpack4中，去掉了这个插件改为<code>optimization.concatenateModules</code>配置，默认在<code>生产环境是开启的</code></p></blockquote></li><li>使用 ES6 模块来开启 <code>tree shaking</code>,css通过<code>purgecss-webpack-plugin</code>插件进行<code>tree-shanking</code>优化</li><li>按照路由拆分代码，实现按需加载</li><li>使用<code>webpack-bundle-analyzer</code>对打包文件进行分析，将大文件模块提取出来在html中单独加载<br> webpack配置：<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ...</span>
<span class="token literal-property property">externals</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&#39;element-ui&#39;</span><span class="token operator">:</span> <span class="token string">&#39;Element&#39;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&#39;v-charts&#39;</span><span class="token operator">:</span> <span class="token string">&#39;VCharts&#39;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>html:<div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/element-ui@2.10.0/lib/index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>webpack持久化缓存；<a href="https://github.com/pigcan/blog/issues/9" target="_blank" rel="noopener noreferrer">参考<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><br><a href="https://juejin.im/entry/5c302140f265da611b587f99" target="_blank" rel="noopener noreferrer">参考<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>、<a href="https://github.com/happylindz/blog/issues/8" target="_blank" rel="noopener noreferrer">优化<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>、<a href="https://github.com/LinDaiDai/niubility-coding-js/blob/master/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/webpack/%E9%9C%96%E5%91%86%E5%91%86%E7%9A%84webpack%E4%B9%8B%E8%B7%AF-%E4%BC%98%E5%8C%96%E7%AF%87.md" target="_blank" rel="noopener noreferrer">参考<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>、<a href="https://juejin.im/entry/5c302140f265da611b587f99" target="_blank" rel="noopener noreferrer">参考<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>、<a href="http://louiszhai.github.io/2019/01/04/webpack4/" target="_blank" rel="noopener noreferrer">优化<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>、(优化)[https://juejin.im/post/5d5788a3f265da03986bef0d?utm_source=gold_browser_extension]</li></ul></li></ul><h2 id="webpack-热更新原理" tabindex="-1"><a class="header-anchor" href="#webpack-热更新原理" aria-hidden="true">#</a> webpack 热更新原理</h2><ul><li>开启热更新后会启动一个<code>HMR Server</code>服务,同时在打包文件中注入<code>HMR Runtime</code>(用来启动websocket,来保持和server的通信,通过修改<code>entry</code>配置注入)</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 修改后的entry入口</span>
<span class="token punctuation">{</span> <span class="token literal-property property">entry</span><span class="token operator">:</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">index</span><span class="token operator">:</span> 
    <span class="token punctuation">[</span>
      <span class="token comment">// 添加websocket代码</span>
      <span class="token string">&#39;xxx/node_modules/webpack-dev-server/client/index.js?http://localhost:8080&#39;</span><span class="token punctuation">,</span>
      <span class="token comment">// 检查更新逻辑</span>
      <span class="token string">&#39;xxx/node_modules/webpack/hot/dev-server.js&#39;</span><span class="token punctuation">,</span>
      <span class="token comment">// 自己的入口</span>
      <span class="token string">&#39;./src/index.js&#39;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>热更新插件会在webpack的<code>compiler.hooks.done</code>钩子中注册监听编译完成事件,当修改了一个或多个文件是,webpack会重新编译,编译完成后触发钩子</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">setupHooks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>done<span class="token punctuation">}</span> <span class="token operator">=</span> compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">;</span>
  <span class="token comment">// 监听webpack的done钩子，tapable提供的监听方法</span>
  done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&#39;webpack-dev-server&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_sendStats</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sockets<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getStats</span><span class="token punctuation">(</span>stats<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_stats <span class="token operator">=</span> stats<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>server服务会在编译完成后通过<code>websoket</code>想浏览器发送<code>hash</code>和<code>ok</code>事件</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 通过websoket给客户端发消息</span>
<span class="token function">_sendStats</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sockWrite</span><span class="token punctuation">(</span>sockets<span class="token punctuation">,</span> <span class="token string">&#39;hash&#39;</span><span class="token punctuation">,</span> stats<span class="token punctuation">.</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发送最新hash</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sockWrite</span><span class="token punctuation">(</span>sockets<span class="token punctuation">,</span> <span class="token string">&#39;ok&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通知刷新</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>浏览器利用<code>hash</code>,发送<code>xxx/${hash}.hot-update.json</code>请求,获取下次更新的<code>hash</code>和更新模块</li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;h&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0c256052432b51ed32c8&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 下次更新hash</span>
  <span class="token property">&quot;c&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;302&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 更新的模块,如果没有则不需要更新</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>同时浏览器利用<code>hash</code>,发送<code>xxx/${hash}.hot-update.js</code>请求,利用<code>jsop</code>方式返回更新模块代码,<code>jsonp</code>的方式对返回的代码可以直接执行</li></ul><p><a href="https://juejin.cn/post/6844904008432222215" target="_blank" rel="noopener noreferrer">参考<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>、<a href="https://zhuanlan.zhihu.com/p/30623057" target="_blank" rel="noopener noreferrer">参考<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>、<a href="https://zhuanlan.zhihu.com/p/30669007" target="_blank" rel="noopener noreferrer">参考<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="webpack环境变量" tabindex="-1"><a class="header-anchor" href="#webpack环境变量" aria-hidden="true">#</a> webpack环境变量</h2><ul><li>package.json中设置，为了兼容性需要用cross-env包</li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production webpack --config webpack.config.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=development webpack-dev-server&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>在命令行中设置</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>webpack <span class="token parameter variable">--env.production</span>   // 设置 env.production <span class="token operator">==</span> <span class="token boolean">true</span>
webpack <span class="token parameter variable">--env.platform</span><span class="token operator">=</span>web  // 设置 env.platform <span class="token operator">==</span> <span class="token string">&quot;web&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>注意，这种方式需要对<code>webpack配置</code>的module.exports原来指向对象的方式改为函数</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">env</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;NODE_ENV: &#39;</span><span class="token punctuation">,</span> env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span> <span class="token comment">// &#39;local&#39;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;platform: &#39;</span><span class="token punctuation">,</span> env<span class="token punctuation">.</span>platform<span class="token punctuation">)</span> <span class="token comment">// web</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&#39;./src/index.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;bundle.js&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;dist&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>通过<code>DefinePlugin</code>配置</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> env <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token constant">BASE_API</span><span class="token operator">:</span><span class="token string">&#39;&quot;https://www.xxxx.com&quot;&#39;</span> <span class="token comment">// 其它一些参数配置</span>
<span class="token punctuation">}</span>
<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token string-property property">&#39;p<wbr>rocess.env&#39;</span><span class="token operator">:</span> env<span class="token punctuation">,</span>
      <span class="token string-property property">&#39;p<wbr>rocess.env.NODE_ENV&#39;</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>配置文件<code>mode</code></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// 定义环境变量</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;development&#39;</span><span class="token punctuation">,</span>
    <span class="token comment">// JavaScript 执行入口文件</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&#39;./main.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 把所有依赖的模块合并输出到一个 bundle.js 文件</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;bundle.js&#39;</span><span class="token punctuation">,</span>
        <span class="token comment">// 输出文件都放到 dist 目录下</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./dist&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 或者执行时设置</span>
webpack <span class="token operator">--</span>mode<span class="token operator">=</span>production
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>注意： 设置<code>mode</code>webpack内部会自动执行<code>DefinePlugin</code><a href="https://www.webpackjs.com/concepts/mode/" target="_blank" rel="noopener noreferrer">设置变量<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><br> 注意：npm脚本里的设置多用于<code>配置相关</code>;而DefinePlugin和mode选项定义的NODE_ENV 作用于webpack入口文件下的<code>业务代码</code></p></blockquote><h2 id="gulp和webpack的区别" tabindex="-1"><a class="header-anchor" href="#gulp和webpack的区别" aria-hidden="true">#</a> gulp和webpack的区别</h2><ul><li>gulp强调的是工作流；通过配置一系列task，顺序执行来构建工作流程</li><li>webpack是一个前端模块化解决方案，侧重于模块化打包，将一切（图片、文件）都视为模块；通过loader（加载器）和plugins（插件）对资源进行处理</li></ul></div><!--[--><!--[--><ins class="adsbygoogle" style="display:block;text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5929253442306992" data-ad-slot="4632953657"></ins><div class="money"><div class="pay">小红包免费领</div><div class="pay">小礼物走一走</div></div><!----><!--]--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 994917123@qq.com">slbyml</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--[--><div class="ff"> 部分内容来源于网络，如有侵权，请留言或联系994917123@qq.com;访问量:<span id="busuanzi_value_site_pv">waiting</span>;访客数:<span id="busuanzi_value_site_uv">waiting</span></div><!--]--><!--]--></main><!--]--></div><div id="gift" style="width:250px;font-size:0;background:#ca3039;display:none;"><img src="https://slbblog.oss-cn-beijing.aliyuncs.com/getMoney.png" style="width:100%;"></div><div id="money" style="width:250px;font-size:0;overflow:hidden;text-align:center;display:none;"><p style="font-size:14px;line-height:1.4;">微信扫码</p><img src="https://slbblog.oss-cn-beijing.aliyuncs.com/wechat.jpg" style="width:100%;"></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.fded88d1.js" defer></script>
  </body>
</html>
