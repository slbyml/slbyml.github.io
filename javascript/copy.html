<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta name="keywords" content="web前端,前端面试题,HTML5,CSS3,CSS,jQuery,JS,JavaScript,前端,vue,博客,技术文章,静水深流,react,18禁"><meta name="author" content="shaolibao"><meta name="google-site-verification" content="018PP6ptGKwOerKbKgiOwbvtEvXE4z1MbWL70S53pUg"><meta name="baidu-site-verification" content="code-zwVA5PHMGk"><meta name="360-site-verification" content="1e93b200c2a643d4d9569c2315bd46a2"><meta name="sogou_site_verification" content="riHbZyBSqZ"><meta name="msvalidate.01" content="18F16D4763157255069DFE0F9ADEF271"><link rel="shortcut icon" href="/link.jpg" type="image/jpg"><link rel="manifest" href="/manifest.webmanifest"><meta name="theme-color" content="#1e90ff"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="apple-touch-icon" href="/link.jpg"><link rel="mask-icon" href="/link.jpg" color="#1e90ff"><meta name="msapplication-TileImage" content="/link.jpg"><meta name="msapplication-TileColor" content="#000000"><link rel="stylesheet" href="https://slbblog.oss-cn-beijing.aliyuncs.com/s3Layer.css"><script src="https://hm.baidu.com/hm.js?5ebfc1c23339503a9d4d7fae0f2b1f17" defer="true"></script><script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5929253442306992" crossorigin="anonymous" async></script><title>如何使用javascript实现复制出的文案带链接？ | 静水深流</title><meta name="description" content="开发者在用户允许的情况下可以通过JavaScript来读写剪贴板；从而方便的实现粘贴、复制等能力；本文会研究Clipboard API和execCommand的使用方法，同时也会简单研读下开源项目clipboard.js是如何实现的复制能力。">
    <link rel="modulepreload" href="/assets/app.fded88d1.js"><link rel="modulepreload" href="/assets/copy.html.81e8940a.js"><link rel="modulepreload" href="/assets/copy.html.55febbab.js"><link rel="prefetch" href="/assets/index.html.ff05003d.js"><link rel="prefetch" href="/assets/link.html.507bf71d.js"><link rel="prefetch" href="/assets/list.html.ff505004.js"><link rel="prefetch" href="/assets/css.html.7f733be1.js"><link rel="prefetch" href="/assets/free.html.0feb0fcf.js"><link rel="prefetch" href="/assets/http.html.435b0012.js"><link rel="prefetch" href="/assets/js-theory.html.4ebdf728.js"><link rel="prefetch" href="/assets/virtaul.html.91460542.js"><link rel="prefetch" href="/assets/vue.html.36a4848b.js"><link rel="prefetch" href="/assets/webpack.html.81589ebc.js"><link rel="prefetch" href="/assets/cache.html.0cbdab91.js"><link rel="prefetch" href="/assets/diff.html.57dd80cf.js"><link rel="prefetch" href="/assets/easy.html.233613c9.js"><link rel="prefetch" href="/assets/hard.html.9c4848c0.js"><link rel="prefetch" href="/assets/medium.html.3aee136b.js"><link rel="prefetch" href="/assets/sort.html.6f1a08a5.js"><link rel="prefetch" href="/assets/study.html.482502b1.js"><link rel="prefetch" href="/assets/shape.html.2d3e013d.js"><link rel="prefetch" href="/assets/safe.html.d33be7f7.js"><link rel="prefetch" href="/assets/sse.html.154efe35.js"><link rel="prefetch" href="/assets/axios.html.6903b3c6.js"><link rel="prefetch" href="/assets/bit.html.66197f95.js"><link rel="prefetch" href="/assets/clone.html.d5486022.js"><link rel="prefetch" href="/assets/diff.html.2f433539.js"><link rel="prefetch" href="/assets/domCode.html.17db01a3.js"><link rel="prefetch" href="/assets/extend.html.24791588.js"><link rel="prefetch" href="/assets/flatten.html.02862112.js"><link rel="prefetch" href="/assets/genre.html.13d56231.js"><link rel="prefetch" href="/assets/js.html.3fde62f5.js"><link rel="prefetch" href="/assets/type.html.0c84c9b2.js"><link rel="prefetch" href="/assets/blog.html.127ad1f4.js"><link rel="prefetch" href="/assets/blog_old.html.1c40ee5d.js"><link rel="prefetch" href="/assets/oauth.html.46e5d03a.js"><link rel="prefetch" href="/assets/zoom.html.17d16f08.js"><link rel="prefetch" href="/assets/404.html.50edea1e.js"><link rel="prefetch" href="/assets/index.html.8d91edcc.js"><link rel="prefetch" href="/assets/link.html.3f0e9706.js"><link rel="prefetch" href="/assets/list.html.d90ec71c.js"><link rel="prefetch" href="/assets/css.html.71c1ac2d.js"><link rel="prefetch" href="/assets/free.html.b3bde6ce.js"><link rel="prefetch" href="/assets/http.html.23976a1a.js"><link rel="prefetch" href="/assets/js-theory.html.40bc387a.js"><link rel="prefetch" href="/assets/virtaul.html.09b3b2e4.js"><link rel="prefetch" href="/assets/vue.html.0e605c45.js"><link rel="prefetch" href="/assets/webpack.html.a609a935.js"><link rel="prefetch" href="/assets/cache.html.e4f1c686.js"><link rel="prefetch" href="/assets/diff.html.d37ccae3.js"><link rel="prefetch" href="/assets/easy.html.f81ed90e.js"><link rel="prefetch" href="/assets/hard.html.a13d0829.js"><link rel="prefetch" href="/assets/medium.html.8c2f1876.js"><link rel="prefetch" href="/assets/sort.html.7976d748.js"><link rel="prefetch" href="/assets/study.html.519196f5.js"><link rel="prefetch" href="/assets/shape.html.b86a87a0.js"><link rel="prefetch" href="/assets/safe.html.6f870daf.js"><link rel="prefetch" href="/assets/sse.html.0ded2924.js"><link rel="prefetch" href="/assets/axios.html.3521c585.js"><link rel="prefetch" href="/assets/bit.html.7e38910d.js"><link rel="prefetch" href="/assets/clone.html.a3f4f8c8.js"><link rel="prefetch" href="/assets/diff.html.8f3d4f3a.js"><link rel="prefetch" href="/assets/domCode.html.5af9dbb4.js"><link rel="prefetch" href="/assets/extend.html.08b6491f.js"><link rel="prefetch" href="/assets/flatten.html.2dcb730c.js"><link rel="prefetch" href="/assets/genre.html.c2f4dbdd.js"><link rel="prefetch" href="/assets/js.html.6f50e308.js"><link rel="prefetch" href="/assets/type.html.95a7c0e6.js"><link rel="prefetch" href="/assets/blog.html.6f407294.js"><link rel="prefetch" href="/assets/blog_old.html.970a710d.js"><link rel="prefetch" href="/assets/oauth.html.21dac46c.js"><link rel="prefetch" href="/assets/zoom.html.3a97e1d1.js"><link rel="prefetch" href="/assets/404.html.22449b3e.js"><link rel="prefetch" href="/assets/index.6fc1ed56.js"><link rel="prefetch" href="/assets/giscus.9d85e3c1.js"><link rel="prefetch" href="/assets/s3Layer.umd.min.9cf41daf.js">
    <link rel="stylesheet" href="/assets/style.815e0284.css">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!----><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">静水深流</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/list.html" class="" aria-label="文章"><!--[--><!--]--> 文章 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://slbyml.github.io/jsLibrary/" rel="noopener noreferrer" target="_blank" aria-label="demo"><!--[--><!--]--> demo <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/slbyml" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/list.html" class="" aria-label="文章"><!--[--><!--]--> 文章 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://slbyml.github.io/jsLibrary/" rel="noopener noreferrer" target="_blank" aria-label="demo"><!--[--><!--]--> demo <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/slbyml" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">如何使用javascript实现复制出的文案带链接？ <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/javascript/copy.html#监听并修改复制内容" class="router-link-active router-link-exact-active sidebar-item" aria-label="监听并修改复制内容"><!--[--><!--]--> 监听并修改复制内容 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/javascript/copy.html#navigator-clipboard-api" class="router-link-active router-link-exact-active sidebar-item" aria-label="navigator.clipboard API"><!--[--><!--]--> navigator.clipboard API <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/javascript/copy.html#execcommand方法" class="router-link-active router-link-exact-active sidebar-item" aria-label="execCommand方法"><!--[--><!--]--> execCommand方法 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/javascript/copy.html#clipboard-js原理" class="router-link-active router-link-exact-active sidebar-item" aria-label="clipboard.js原理"><!--[--><!--]--> clipboard.js原理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/javascript/copy.html#参考" class="router-link-active router-link-exact-active sidebar-item" aria-label="参考"><!--[--><!--]--> 参考 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="如何使用javascript实现复制出的文案带链接" tabindex="-1"><a class="header-anchor" href="#如何使用javascript实现复制出的文案带链接" aria-hidden="true">#</a> 如何使用javascript实现复制出的文案带链接？</h1><p>上段时间做需求时，产品在中途突然添加了一个新功能：实现一键复制功能；也就是如下，点击<code>复制链接</code>后，会复制出一段拼接好的title文案，粘贴到飞书后的文案是携带链接的，可以在浏览器打开指定页面</p><p><img src="https://slbblog.oss-cn-beijing.aliyuncs.com/blog/image-20230714162508430.png?x-oss-process=image/interlace,1/watermark,text_c2xieW1sLmdpdGh1Yi5pbw,color_000000,size_25,rotate_7,x_25,y_50,,image/resize,w_500" alt="复制"></p><p>当时第一反应是做不了，因为在浏览器里当选中 <code>a标签</code>里的内容时，浏览器会自动完成这件事，所以一直感觉这是浏览器自带的能力，javascript以前只接触过复制纯文字的，其它复杂功能大概率干不了，但是直接跟产品说做不了是很没说服力的，所以想先调研下，有理有据的把需求怼回去</p><h2 id="监听并修改复制内容" tabindex="-1"><a class="header-anchor" href="#监听并修改复制内容" aria-hidden="true">#</a> 监听并修改复制内容</h2><p>以前在做<a href="https://slbyml.github.io/saves/blog.html#%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8A%9F%E8%83%BD" target="_blank" rel="noopener noreferrer">个人博客<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>时做过监听并修改用户复制的内容的功能，其实现原理就是通过监听<code>copy</code>事件来实现：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;copy&quot;</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> clipboardData <span class="token operator">=</span> e<span class="token punctuation">.</span>clipboardData <span class="token operator">||</span> window<span class="token punctuation">.</span>clipboardData
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>clipboardData<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> copyTxt <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
  e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取消默认的复制事件</span>
  copyTxt <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 网页上选中的内容</span>
  copyTxt <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>copyTxt<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n作者：邵XX\n原文：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</span><span class="token template-punctuation string">`</span></span>
  clipboardData<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">&#39;text/plain&#39;</span><span class="token punctuation">,</span> copyTxt<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在用户复制的时候，我们会在复制内容后面自动添加版权和出处等内容；很明显，虽然可以做到自定义剪切板内容的功能，但是这是被动监听的行为，用在这个需求是不靠谱的；</p><h2 id="navigator-clipboard-api" tabindex="-1"><a class="header-anchor" href="#navigator-clipboard-api" aria-hidden="true">#</a> navigator.clipboard API</h2><p>搜索发现<code>Clipboard</code> 接口实现了<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Clipboard_API" target="_blank" rel="noopener noreferrer">Clipboard API<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>；在用户授予相应权限的情况下可以异步实现剪切板的读写能力，在开发环境或者https协议下的页面才可以调用这个API；</p><p>它返回一个Promise对象，如果剪切板被拒绝访问，Promise也会被拒绝；其主要有一下四个方法：</p><ul><li><p><code>read</code>：返回的是一个<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ClipboardItem" target="_blank" rel="noopener noreferrer">ClipboardItem<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>对象的数组；我们可以通过他获取剪切板数据；比如图片、文本等；我们可以将以下代码复制到浏览器开发者工具内执行，然后进行网页内容复制即可看到剪切板内容</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;copy&quot;</span><span class="token punctuation">,</span> <span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    navigator<span class="token punctuation">.</span>clipboard<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">clipboardItems</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;ClipboardItem:&#39;</span><span class="token punctuation">,</span> clipboardItems<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> clipboardItem <span class="token keyword">of</span> clipboardItems<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> type <span class="token keyword">of</span> clipboardItem<span class="token punctuation">.</span>types<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">await</span> clipboardItem<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
          blob<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">%ctype：%c</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">，%c复制内容：%c</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>res<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">&#39;color:blue&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;color:#333&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;color:blue&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;color:#333&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;读取失败：&#39;</span><span class="token punctuation">,</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><blockquote><p>注意：<code>读</code>剪切板的操作需要用户明确同意（浏览器会弹授权对话框），这也是浏览器为了用户安全和隐私而设计的；如果用户不同意会报错；因此最好使用<code>try...catch</code>来包裹逻辑</p></blockquote><ul><li><p><code>readText</code>：和上面类似，只不过它返回的是从剪切板中检索到的纯文本数据；</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;copy&quot;</span><span class="token punctuation">,</span> <span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  navigator<span class="token punctuation">.</span>clipboard<span class="token punctuation">.</span><span class="token function">readText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">%c复制内容：%c</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>res<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">&#39;color:blue&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;color:#333&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>write</code>：向系统剪贴板写入任意内容；它以<code>ClipboardItem</code>实例作为参数，<code>ClipboardItem</code> 是浏览器原生提供的构造函数，键名为<a href="https://www.iana.org/assignments/media-types/media-types.xhtml" target="_blank" rel="noopener noreferrer">MIME type<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>类型、键值为数据的<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob" target="_blank" rel="noopener noreferrer">Bold<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>类型；操作完成返回promise的成功回调；然后就可以在任意聊天软件（飞书、微信）内进行粘贴发送了</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">testClipboardCopy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> imgURL <span class="token operator">=</span> <span class="token string">&#39;https://slbblog.oss-cn-beijing.aliyuncs.com/head.png&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>imgURL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">await</span> data<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> item <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">window<span class="token punctuation">.</span>ClipboardItem</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token punctuation">[</span>blob<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token operator">:</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> navigator<span class="token punctuation">.</span>clipboard<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;图片已被复制！现在可以向聊天软件内发送了&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">testClipboardCopy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>writeText</code>：同上，只不过写入的是文本数据</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>navigator<span class="token punctuation">.</span>clipboard<span class="token punctuation">.</span><span class="token function">writeText</span><span class="token punctuation">(</span><span class="token string">&quot;向剪切板写入内容&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;写入成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><p>我们发现<code>write</code>方法可以非常方便、灵活的往剪切板放入多种格式的内容，非常符合我们的需求；因此基于Clipboard来实现我们需求的代码很容易就能写出来了：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">testClipboardCopy</span><span class="token punctuation">(</span><span class="token parameter">title<span class="token punctuation">,</span> url<span class="token operator">=</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>title<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;text/plain&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> href <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;a href=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/a&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;text/html&#39;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 定义要放入的内容</span>
      <span class="token keyword">const</span> item <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">window<span class="token punctuation">.</span>ClipboardItem</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token string-property property">&#39;text/plain&#39;</span><span class="token operator">:</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string-property property">&#39;text/html&#39;</span><span class="token operator">:</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>href<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      navigator<span class="token punctuation">.</span>clipboard<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;复制失败&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">testClipboardCopy</span><span class="token punctuation">(</span><span class="token string">&quot;测试复制&quot;</span><span class="token punctuation">,</span> <span class="token string">&#39;https://slbyml.github.io/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;复制成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>虽然Clipboard API如此强大与方便；但它的兼容却让人堪：<a href="https://caniuse.com/?search=clipboard" target="_blank" rel="noopener noreferrer">clipboard API兼容性<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>、<a href="https://caniuse.com/?search=ClipboardItem" target="_blank" rel="noopener noreferrer">ClipboardItem 兼容性<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>；通过caniuse查询可以发现各方法的兼容性不尽相同，总体来说chrome浏览器还好，firefox简直不忍直视，完全不兼容；</p><h2 id="execcommand方法" tabindex="-1"><a class="header-anchor" href="#execcommand方法" aria-hidden="true">#</a> execCommand方法</h2><p><code>document.execCommand</code>算是非常老牌操作剪贴板的方法了，它的返回值是<code>Boolean</code>如果是 <code>false</code> 则表示操作不被支持或未被启用。</p><p>此方法基本得到了各大浏览器厂商的支持；虽然在<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/execCommand" target="_blank" rel="noopener noreferrer">MDN<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>上已经给出了提示：不再推荐使用该特性，但因为其良好的兼容性，使其依然在被广泛使用；</p><p>虽然此方法兼容性如此的好，但是它依然有它的不足，这也是导致官方要放弃它，另寻新欢的原因：</p><ul><li>需要先手动选中或者配合<code>createRange</code>等操作选区的方法来选中要复制的内容，灵活度不够</li><li><code>execCommand</code>是一个同步方法，如果要复制的内容比较多的话，极易造成卡顿、暂时失去响应等问题</li></ul><p>比较常见的使用就是通过<code>textarea</code>复制一段文案到剪切板:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> textarea <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;textarea&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>textarea<span class="token punctuation">)</span><span class="token punctuation">;</span>
  textarea<span class="token punctuation">.</span>style<span class="token punctuation">.</span>cssText <span class="token operator">=</span> <span class="token string">&#39;position: absolute;left:-9999px;opacity:0&#39;</span><span class="token punctuation">;</span>
  textarea<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&#39;测试execCommand复制能力&#39;</span><span class="token punctuation">;</span>
  <span class="token comment">// 选中要复制的文本</span>
  textarea<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> isCopy <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span><span class="token string">&#39;copy&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>textarea<span class="token punctuation">)</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isCopy<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;复制失败&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在我们的需求中，需要的并不是复制纯文案，而是需要复制文本链接；幸运的是我们可以通过<code>createRange</code>创建选区来模拟用户选中网页内容并复制的操作</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>btns<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> _a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  _a<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&#39;测试execCommand复制能力&#39;</span><span class="token punctuation">;</span>
  _a<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;href&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;https://slbyml.github.io/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  _a<span class="token punctuation">.</span>style<span class="token punctuation">.</span>cssText <span class="token operator">=</span> <span class="token string">&#39;position: absolute;left:-9999px;opacity:0&#39;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 创建选区</span>
  <span class="token keyword">const</span> range <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  range<span class="token punctuation">.</span><span class="token function">selectNode</span><span class="token punctuation">(</span>_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 先清除网页已有的选区</span>
  window<span class="token operator">?.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">removeAllRanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 选中我们创建出来的内容</span>
  window<span class="token operator">?.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">addRange</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> isCopy <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span><span class="token string">&#39;copy&#39;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  window<span class="token operator">?.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">removeAllRanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isCopy<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;复制失败&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当然，如果不放心，javascript也为我们提供了检测当前浏览器是否支持指定的编辑指令的原生方法</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> isSupported <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">queryCommandSupported</span><span class="token punctuation">(</span><span class="token string">&#39;copy&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="clipboard-js原理" tabindex="-1"><a class="header-anchor" href="#clipboard-js原理" aria-hidden="true">#</a> clipboard.js原理</h2><p>这是一个非常知名的操作剪切板的开源项目；项目整体的体积也不是很大，压缩后大概<code>12kb</code>；现在有非常多的开源项目比如<code>boostrap</code>都在使用这个开源项目来实现复制、剪切的能力。</p><p>我们先用clipboard.js写个小demo来实现我们本次的需求：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>测试复制能力<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>clipboard.js<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://slbyml.github.io/<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span><span class="token property">left</span><span class="token punctuation">:</span> -9999px</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>测试clipboard.js的能力<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">var</span> btns <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&#39;.btn&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> clipboard <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClipboardJS</span><span class="token punctuation">(</span>btns<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token function">target</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      clipboard<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;success&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      clipboard<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以发现整个逻辑实现起来还是很简单的；其实clipboard.js的原码也是非常简单的，我们可以根据我们这个demo看下整个逻辑实现下来是如何实现复制的</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Clipboard</span> <span class="token keyword">extends</span> <span class="token class-name">Emitter</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">trigger<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolveOptions</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">listenClick</span><span class="token punctuation">(</span>trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 其它...</span>
 <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>整个构造函数继承自<code>Emitter</code>函数，<code>Emitter</code>是一个轻量级的发布订阅模式库；主要作用就是向外部发送<code>success</code>和<code>error</code>来告诉我们剪切板操作成功还是失败</p><p><code>new ClipboardJS()</code>后主要做了两件事情，<code>resolveOptions()</code>和<code>listenClick()</code>；</p><p>第一个函数是初始化我们传的参数，将字符串参数转为函数、设置默认值；逻辑比较简单，不是我们的重点</p><p>第二个函数就是为我们的按钮绑定<code>click</code>事件，并在我们触发对应事件的时候执行相应动作</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">listenClick</span><span class="token punctuation">(</span><span class="token parameter">trigger</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>listener <span class="token operator">=</span> <span class="token function">listen</span><span class="token punctuation">(</span>trigger<span class="token punctuation">,</span> <span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">onClick</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> trigger <span class="token operator">=</span> e<span class="token punctuation">.</span>delegateTarget <span class="token operator">||</span> e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">;</span>
  <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span>trigger<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&#39;copy&#39;</span><span class="token punctuation">;</span> <span class="token comment">// copy还是cut</span>
  <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token function">ClipboardActionDefault</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    action<span class="token punctuation">,</span>
    <span class="token literal-property property">container</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>container<span class="token punctuation">,</span> <span class="token comment">// 我们没传，所以是document.body</span>
    <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">target</span><span class="token punctuation">(</span>trigger<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>trigger<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 通知外部是否操作成功</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span>text <span class="token operator">?</span> <span class="token string">&#39;success&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    action<span class="token punctuation">,</span> text<span class="token punctuation">,</span> trigger<span class="token punctuation">,</span>
    <span class="token function">clearSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>trigger<span class="token punctuation">)</span> <span class="token punctuation">{</span> trigger<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeAllRanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>调用<code>ClipboardActionDefault</code>函数，根据返回值触发<code>emit</code>通知外部操作结果；那么我们的重点其实就变成了<code>ClipboardActionDefault</code>函数</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">ClipboardActionDefault</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> action <span class="token operator">=</span> <span class="token string">&#39;copy&#39;</span><span class="token punctuation">,</span> container<span class="token punctuation">,</span> target<span class="token punctuation">,</span> text <span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>
	<span class="token comment">//... 省略部分错误判断的代码</span>

  <span class="token comment">// 优先text参数使用</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">ClipboardActionCopy</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token punctuation">{</span> container <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

	
  <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> action <span class="token operator">===</span> <span class="token string">&#39;cut&#39;</span>
      <span class="token operator">?</span> <span class="token function">ClipboardActionCut</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
      <span class="token operator">:</span> <span class="token function">ClipboardActionCopy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token punctuation">{</span> container <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此函数有两个主要判断：</p><ul><li>如果使用时传了<code>text</code>参数，则优先复制这个参数里的内容</li><li>如果传递了<code>target</code> 则判断使用粘贴还是复制功能</li></ul><p>根据我们的demo，我们使用的<code>target</code>和<code>copy</code>，所以进入的是<code>ClipboardActionCopy(target, { container })</code>方法；因此我们继续往里面看</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">ClipboardActionCopy</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token parameter">target<span class="token punctuation">,</span> 
  options <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">container</span><span class="token operator">:</span> document<span class="token punctuation">.</span>body <span class="token punctuation">}</span></span>
<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> selectedText <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> target <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 只有参数传递了text才会进入此判断</span>
    selectedText <span class="token operator">=</span> <span class="token function">fakeCopyAction</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
    <span class="token comment">// 传递的target是一个input标签</span>
    target <span class="token keyword">instanceof</span> <span class="token class-name">HTMLInputElement</span> <span class="token operator">&amp;&amp;</span>
    <span class="token operator">!</span><span class="token punctuation">[</span><span class="token string">&#39;text&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;search&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;url&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;tel&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;password&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>target<span class="token operator">?.</span>type<span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    selectedText <span class="token operator">=</span> <span class="token function">fakeCopyAction</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>value<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    selectedText <span class="token operator">=</span> <span class="token function">select</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">command</span><span class="token punctuation">(</span><span class="token string">&#39;copy&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> selectedText<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们重点放在最后一条判断上；最后一条主要做了两件事情：</p><ul><li><p>选中元素</p><p><code>select</code>是一个三方库，用来选中标签的内容，大致选中逻辑：<code>SELECT标签使用</code>focus<code>进行选中、INPUT和</code>TEXTAREA<code>标签使用</code>setSelectionRange<code>进行选中、其他的使用</code>getSelection<code>和</code>createRange`进行选中</p></li><li><p>复制元素</p><p>这一步就非常简单了，主要代码就一行<code>document.execCommand(type)</code>翻译出来就是<code>document.execCommand(copy)</code></p></li></ul><p>整个复制流程到这就结束，可以发现的是它的实现和我们自己写的基本是一致的；下面我们大致梳理一遍<code>clipboard.js</code>流程</p><p><img src="https://slbblog.oss-cn-beijing.aliyuncs.com/blog/11.png?x-oss-process=image/interlace,1/watermark,text_c2xieW1sLmdpdGh1Yi5pbw,color_000000,size_25,rotate_7,x_25,y_50,,image/resize,w_500" alt="clipboard"></p><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考" aria-hidden="true">#</a> 参考</h2><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Navigator/clipboard" target="_blank" rel="noopener noreferrer">Navigator.clipboard MDN<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://www.ruanyifeng.com/blog/2021/01/clipboard-api.html" target="_blank" rel="noopener noreferrer">剪贴板操作 Clipboard API 教程<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://www.zhangxinxu.com/wordpress/2021/10/js-copy-paste-clipboard/" target="_blank" rel="noopener noreferrer">JS复制文字到剪切板的极简实现及扩展<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><!--[--><!--[--><ins class="adsbygoogle" style="display:block;text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5929253442306992" data-ad-slot="4632953657"></ins><div class="money"><div class="pay">小红包免费领</div><div class="pay">小礼物走一走</div></div><!----><!--]--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: shaolibao@xiaomi.com">邵礼豹</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--[--><div class="ff"> 部分内容来源于网络，如有侵权，请留言或联系994917123@qq.com;访问量:<span id="busuanzi_value_site_pv">waiting</span>;访客数:<span id="busuanzi_value_site_uv">waiting</span></div><!--]--><!--]--></main><!--]--></div><div id="gift" style="width:250px;font-size:0;background:#ca3039;display:none;"><img src="https://slbblog.oss-cn-beijing.aliyuncs.com/getMoney.png" style="width:100%;"></div><div id="money" style="width:250px;font-size:0;overflow:hidden;text-align:center;display:none;"><p style="font-size:14px;line-height:1.4;">微信扫码</p><img src="https://slbblog.oss-cn-beijing.aliyuncs.com/wechat.jpg" style="width:100%;"></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.fded88d1.js" defer></script>
  </body>
</html>
